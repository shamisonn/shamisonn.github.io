<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  
  <title>shamisonn.github.io; | タブーサーチの話</title>  
  
  <link href="/css/style.css" rel="stylesheet">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-130792681-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-130792681-1');
  </script>
</head>

<body>
  <header class="header">
    <h1 class="title">shamisonn.github.io;</h1>
    <p class="subtitle">
      The Personal Pages | <a href="/">index</a> | <a href="/about">about</a> | <a href="/posts">posts</a>
    </p>
  </header>
  <main class="post">
    <h1 class="title">タブーサーチの話</h1>
    <script async="" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_HTML&amp;locale=ja"></script>

<p>この記事は <a href="https://adventar.org/calendars/3478#list-2018-12-06" target="_blank">PMOB Advent Calendar 2018 - Adventar</a> 7日目の記事です。</p>

<p>師走。早いですね。
師走の語源って明確に存在しないって知ってました？
そうおもうとなんだか気持ち悪いですね。</p>

<p>はい。</p>

<p>アルゴリズムの話を書きます。
メタヒューリスティクスってやつですね。</p>

<p>いわゆる ヒューリスティクスな手法というのは、
発見的手法とも呼ばれていて立ち位置的には</p>

<p>「数学的に精度に保証はないけど、この手法でやると早かったり、
ある程度の解は出るよ。その証明はないけど。」
みたいなところにあるとおもってます。</p>

<p>よく<em>近似アルゴリズム</em> と <em>ヒューリスティクスなアルゴリズム</em> は混同されがちですが
その違いは<strong>精度保証がなされているか</strong> というところにあると理解してます。</p>

<ul>
  <li><a href="https://ja.wikipedia.org/wiki/%E3%83%92%E3%83%A5%E3%83%BC%E3%83%AA%E3%82%B9%E3%83%86%E3%82%A3%E3%82%AF%E3%82%B9" target="_blank">ヒューリスティクス - Wikipedia</a></li>
</ul>

<p>メタヒューリスティクスとはなにか。</p>

<p>これはつまりヒューリスティクスな手法には色々あって、
だいたいこのフレームワークにそって考えるといい感じに出やすいよ、
みたいなやつだと思ってます。</p>

<p>メタですね。ヒューリスティクスな手法のメタい話。</p>

<ul>
  <li><a href="https://ja.wikipedia.org/wiki/%E3%83%A1%E3%82%BF%E3%83%92%E3%83%A5%E3%83%BC%E3%83%AA%E3%82%B9%E3%83%86%E3%82%A3%E3%82%AF%E3%82%B9" target="_blank">メタヒューリスティクス - Wikipedia</a></li>
</ul>

<p>メタヒューリスティクスの例としては</p>

<ul>
  <li>遺伝的アルゴリズム</li>
  <li>焼きなまし法</li>
</ul>

<p>など多くのものが上げられますが、
その中でもタブー探索法について紹介します。</p>

<h1 id="局所探索法local-search">局所探索法(Local Search)</h1>

<p>タブー探索法は いわゆる 局所探索法の1つです。
一応ざっくりここに書いておきます。</p>

<ul>
  <li><a href="https://ja.wikipedia.org/wiki/%E5%B1%80%E6%89%80%E6%8E%A2%E7%B4%A2%E6%B3%95" target="_blank">局所探索法 - Wikipedia</a></li>
</ul>

<p>上記のwikipediaから引用すると、局所探索法における方法は以下のようになっています。</p>

<blockquote>
  <p>1.解を一つランダムに生成する。</p>
</blockquote>

<blockquote>
  <p>2.現在の解の近傍の内一つをある条件で選び近傍解とする。</p>
</blockquote>

<blockquote>
  <p>3.定義した条件を満たすなら、近傍解を現在の解と入れ換える。</p>
</blockquote>

<blockquote>
  <p>4.終了条件を満たすまで 2. 以下を繰り返す。</p>
</blockquote>

<p>以下イメージです。</p>

<p><img src="http://localhost:4000/assets/posts/2018-12-07/localsearch.jpg" alt="局所探索法のイメージ" /></p>

<p>タブー探索法でもこの手順を追っていきます。</p>

<p>なんか適当に例を上げて問題を解きたいですね。
例として「ナップサック問題」を使います。</p>

<p>有名な問題ですが定義はしておきます。</p>

<h1 id="ナップサック問題-knapsack-problem">ナップサック問題 (Knapsack problem)</h1>

<ul>
  <li><a href="https://ja.wikipedia.org/wiki/%E3%83%8A%E3%83%83%E3%83%97%E3%82%B5%E3%83%83%E3%82%AF%E5%95%8F%E9%A1%8C" target="_blank">ナップサック問題 - Wikipedia</a></li>
</ul>

<p>入力として</p>

<ul>
  <li>品物の集合 <script type="math/tex">I = \{1, 2, ..., N \}</script></li>
  <li>品物の価値の集合 <script type="math/tex">V = \{v_1, v_2, ..., v_N \}</script></li>
  <li>品物の重さの集合 <script type="math/tex">W = \{w_1, w_2, ..., w_N \}</script></li>
  <li>容量 <script type="math/tex">C</script></li>
</ul>

<p>が与えられます。</p>

<p>( このとき <script type="math/tex">i_j</script> <script type="math/tex">(1 \leq j \leq n)</script> の 価値は <script type="math/tex">v_j</script> であり、
重さは <script type="math/tex">w_j</script> と対応しています。 )</p>

<p>問題としては</p>

<div class="highlighter-rouge"><pre class="highlight"><code>「重さの合計が容量Cを超えないように品物を選び、かつ、
選んだ品物の価値の合計をできるだけ大きくするように選びたい。
どうやって選べばよいでしょうか？」
</code></pre>
</div>

<p>という問題になっています。 イメージ図です。</p>

<p><img src="http://localhost:4000/assets/posts/2018-12-07/knapsack.jpg" alt="ナップサック問題のイメージ" /></p>

<p>ようはドロボー問題ですね。</p>

<p>宝石店に盗みに入って宝石を盗まずに、受付の椅子を選ぶアホはいないでしょう、ってことです。
宝石盗んで詰め込めよ、ってことです。よくわからないですね。</p>

<p>数式で表せば <script type="math/tex">x_i = \{0, 1\}</script> とし、</p>

<p><script type="math/tex">x_i</script>が1のときは品物<script type="math/tex">i</script>を選ぶ、<script type="math/tex">x_i</script>が0のときは品物<script type="math/tex">i</script>を選ばない、</p>

<p>としたとき、以下のように表せます。</p>

<p><code class="highlighter-rouge">目的関数: </code><script type="math/tex">\sum_{i \in I} v_i x_i</script></p>

<p><code class="highlighter-rouge">制約条件: </code><script type="math/tex">\sum_{i \in I} w_i x_i \leq C</script></p>

<p>数式はわかりやすいですね。ありがとうwikipedia。</p>

<h1 id="タブー探索法-tabu-search">タブー探索法 (Tabu Search)</h1>

<ul>
  <li><a href="https://ja.wikipedia.org/wiki/%E3%82%BF%E3%83%96%E3%83%BC%E3%82%B5%E3%83%BC%E3%83%81" target="_blank">タブーサーチ - Wikipedia</a></li>
</ul>

<p>局所探索法におけるネックな問題として、
局所解を最適解だと勘違いしてしまうことがあります。</p>

<p><img src="http://localhost:4000/assets/posts/2018-12-07/localandopt.jpg" alt="局所解と最適解のイメージ" /></p>

<p>それを「タブーリスト」という禁止事項リストを作っておくことで、
探索範囲を広くなるようにする、というアプローチになります。</p>

<p>今回はナップザック問題の中でも、
以下の表のような品物と容量が与えられた例を考えます。</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">品物番号</th>
      <th style="text-align: center">価値</th>
      <th style="text-align: center">重さ</th>
      <th style="text-align: center">価値/重さ</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">100</td>
      <td style="text-align: center">200</td>
      <td style="text-align: center">0.50</td>
    </tr>
    <tr>
      <td style="text-align: center">2</td>
      <td style="text-align: center">300</td>
      <td style="text-align: center">20</td>
      <td style="text-align: center">15.00</td>
    </tr>
    <tr>
      <td style="text-align: center">3</td>
      <td style="text-align: center">700</td>
      <td style="text-align: center">700</td>
      <td style="text-align: center">1.00</td>
    </tr>
    <tr>
      <td style="text-align: center">4</td>
      <td style="text-align: center">600</td>
      <td style="text-align: center">680</td>
      <td style="text-align: center">0.88</td>
    </tr>
    <tr>
      <td style="text-align: center">5</td>
      <td style="text-align: center">20</td>
      <td style="text-align: center">100</td>
      <td style="text-align: center">0.20</td>
    </tr>
  </tbody>
</table>

<p>また<strong>容量Cは 800</strong> とします。</p>

<h2 id="1-初期解を生成する">1. 初期解を生成する</h2>

<p>初期解をランダムに生成します。</p>

<p>実際には完全にランダムに生成せずに、
最初の解だけは厳密アルゴリズムや、近似アルゴリズムの手法を利用する、
とかをしたりするケースも見た記憶がありますが定かではないです。</p>

<p>今回は<script type="math/tex">\{ 2, 4, 5 \}</script> を選びこれを初期解としてみます。</p>

<p>またこの際には</p>

<ul>
  <li>価値は <script type="math/tex">300 + 600 + 20 = 920</script></li>
  <li>重さは <script type="math/tex">20 + 680 + 100 = 800</script> (&lt;- 容量ピッタリですね)</li>
</ul>

<p>となります。</p>

<h2 id="2-解から近傍解を生成する">2. 解から近傍解を生成する</h2>

<p>近傍解、ようはこの解の近くにいる解を生成します。
この近傍解をどう定義するのか、ということが非常に大切です。</p>

<p>今回はわかりやすく説明を行うために、ものすごい適当に近傍を定めます。
おそらく精度は悪いです。
(精度をよくするには貪欲法にならうといいのかな、と直感的には思います。)</p>

<p>近傍解を以下のように定めます。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>「現在の解における品物をランダムに1つ選ぶ。
選んだ品物を現在の解から除いて、除く前の解に含まれていない品物を含めたもの。
なお、選んだ品物を除いても近似解が生成できてない場合は、
別の品物を選ぶこととする。」
</code></pre>
</div>

<p>長ったらしくてわかりにくいですね。例を示します。</p>

<p>現在の解は<script type="math/tex">\{ 2, 4, 5 \}</script> ですから、</p>

<p><strong><script type="math/tex">4</script> を選び、除くこととします。</strong></p>

<p>除かれた状態では <script type="math/tex">\{ 2, 5 \}</script> が残りますが、</p>

<p>この際の重さは<script type="math/tex">20 + 100 = 120</script> なります。</p>

<p>よって入れる事のできる品物は 重さが<script type="math/tex">680(= 800 - 120)</script>以下の
品物になります。</p>

<p>入れることができるのは重さが<script type="math/tex">100</script> の <script type="math/tex">1</script> の品物ですね。</p>

<p>これを入れて近傍解としましょう。</p>

<p><code class="highlighter-rouge">近傍解: </code> <script type="math/tex">\{ 1, 2, 5 \}</script></p>

<h2 id="3-近傍解を評価し現在の解を更新する">3. 近傍解を評価し、現在の解を更新する</h2>

<p>近傍解を評価します。
近傍解をどう評価するか、で次に生成されれる近傍解の範囲が変わってきます。</p>

<p>また、今回の例だと近傍解は1つになっていますが、近傍解は複数生成されることがあります。
複数の解からどの解をどのように選ぶか、というのが肝になるわけですね。</p>

<p>今回の例では単純に<strong>「品物の価値の合計」を評価値とします。</strong></p>

<p><code class="highlighter-rouge">近傍解: </code> <script type="math/tex">\{ 1, 2, 5 \}</script> における価値は</p>

<p><script type="math/tex">200 + 300 + 20 = 520</script> ですね。</p>

<p>前に比べてものすごく価値が下がってますね。</p>

<p>ですが<strong>タブー探索法では悪い評価であっても</strong></p>

<p><strong>「タブーリスト」に今回行った操作 と 同じ操作がない限り</strong></p>

<p><strong>解を更新します。</strong></p>

<p>なので、今まで探索した中で最も良い解と、</p>

<p>現在の解を別々に覚えておく必要があるわけですね。</p>

<p>なお、解を更新する際には、</p>

<p>タブー探索法では「タブーリスト」にその操作を覚えておきます。</p>

<p>今回でいうと</p>

<div class="highlighter-rouge"><pre class="highlight"><code>1: remove 4, append 1
</code></pre>
</div>

<p>のようにします。
このように操作を覚えることで局所解に陥ることを防ぎます。</p>

<h3 id="補足">補足</h3>

<p>ナップサック問題では評価をする際に様々な手法が考えられます。
ぱっと思いつくものとして、全く良いものとは思いませんが
「近傍の中で残り容量が少ない物を選ぶ」
という評価の仕方をしても動作はします。</p>

<p>適切な評価法を思いついたり考えつくことが大切ですね。</p>

<h2 id="4--再度近傍を生成する">4.  再度近傍を生成する</h2>

<p>近傍解を決めたので、これを新しい解とします。以下、現在の状態です。</p>

<p>今の解: <script type="math/tex">\{ 1, 2, 5 \}</script> 、最も良い解: <script type="math/tex">\{ 2, 4, 5 \}</script></p>

<p>タブーリスト</p>
<div class="highlighter-rouge"><pre class="highlight"><code>1: remove 4, append 1
</code></pre>
</div>

<p>解から近傍を求めて再度探索を進めましょう。</p>

<p>では、現在の解から 1 を除くこととしましょう。</p>

<p>重みの制限から考えられる近傍解は(計算は省略しますが)</p>

<p><script type="math/tex">4</script>を加えて生成される<script type="math/tex">\{ 2, 4, 5 \}</script></p>

<p>があります。ではこれに解を更新します。</p>

<p>タブーリストには新たに操作履歴を残しておきます。</p>
<div class="highlighter-rouge"><pre class="highlight"><code>1: remove 4, append 1
2: remove 1, append 4 &lt;- new!
</code></pre>
</div>

<p>んん？？これって初期解に戻ってない？？
って思った人がいるかも知れません。</p>

<p>戻ってもいいんです。戻っても。
タブーリストに操作が記述されているからいいんです。</p>

<p>再度探索に戻りましょう。</p>

<hr />

<p>今の解: <script type="math/tex">\{ 2, 4, 5 \}</script> 、最も良い解: <script type="math/tex">\{ 2, 4, 5 \}</script></p>

<p>タブーリスト</p>
<div class="highlighter-rouge"><pre class="highlight"><code>1: remove 4, append 1
2: remove 1, append 4
</code></pre>
</div>

<p>じゃあまた今度は<script type="math/tex">4</script>を再度除くことを考えましょう。
この操作を行おうとすると、タブーリストに引っかかるわけですね。</p>

<p><code class="highlighter-rouge">remove 4, append 1</code> はタブー(禁止)ですよ、となるわけです。</p>

<p>初期解から同じ探索をしていない！！良いですね。</p>

<p>解を更新できなかったので再度選び直しです。</p>

<hr />

<p>今の解: <script type="math/tex">\{ 2, 4, 5 \}</script> 、最も良い解: <script type="math/tex">\{ 2, 4, 5 \}</script></p>

<p>タブーリスト</p>
<div class="highlighter-rouge"><pre class="highlight"><code>1: remove 4, append 1
2: remove 1, append 4
</code></pre>
</div>

<p>では別の品物を除くことを考えましょう。<script type="math/tex">5</script> を除くことを考えます。</p>

<p>そうすると<script type="math/tex">\{ 2, 4 \}</script> の重さの合計は
<script type="math/tex">700(=20+ 680)</script>ですから <script type="math/tex">100(=800-700)</script>以下の品物を</p>

<p>入れることができるでしょう。</p>

<p>となると、入れることのできる品物は <script type="math/tex">1</script> ですかね。
そうなると解は <script type="math/tex">\{1, 2, 4\}</script> となり、</p>

<p>価値は<script type="math/tex">200 + 300 + 600 = 1100</script> になり、</p>

<p>これまでの最も良い解である<script type="math/tex">\{2, 4, 5\}</script> を更新できました！</p>

<hr />

<p>解を更新できたので、現在の解とタブーリストは以下のようになります。</p>

<p>現在の解: <script type="math/tex">\{ 1, 2, 4 \}</script>、最も良い解: <script type="math/tex">\{ 1, 2, 4 \}</script></p>
<div class="highlighter-rouge"><pre class="highlight"><code>1: remove 4, append 1
2: remove 1, append 4
3: remove 5, appned 1
</code></pre>
</div>

<p>このように探索を行っていくわけですね。</p>

<h3 id="補足-1">補足</h3>

<p>なおタブー探索法ではこのタブーリストに覚える操作の数は制限する必要があります。
そうでないと近傍の範囲が縮小していくだけになって、
広い範囲を探索できなくなってしまうためですね。</p>

<p>wikipediaではあまり大きくしないほうが良いと書いてありましたが、
結局実験的手法なので、試してみないとわかりません。</p>

<p>ひたすら実行しまくって実験あるのみです。</p>

<h2 id="終了条件">終了条件</h2>

<p>探索の終了条件としては</p>

<ul>
  <li>全部探索し終えた</li>
  <li>時間制限になった</li>
  <li>規定回数探索した</li>
</ul>

<p>などおおくの条件が考えられます。</p>

<p>問題の大きさや難しさに応じてパラメータを変えることが求められます。</p>

<h1 id="まとめ">まとめ</h1>

<p>ざっくり解説ですがタブー探索法を示してみました。</p>

<p>文字ばっかでよく読めましたね。読める人はすごいです。</p>

<p>私も以前使ったことがありましたが、
色々やって早くならないー勝てないーみたいなことになりがちなので、
ある程度パラメータのチューニングは時間を決めてやるのがよいですね。</p>

<p>あと書き終わって思いましたが、記事にすると自分の脳内の整理にもなってよいですね。
記事を書くのは良いです。</p>


  </main>
  <footer class="footer">
    <p>(C) 2018 shamison</p>
  </footer>
</body>

</html>
